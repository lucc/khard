language: python
python:
  - "3.6"
  - "3.7"
  - "3.8"
  - "3.9"
  - "nightly"
  - "pypy3" # this is 3.6
env:
  - JOB=tests

jobs:
  include:
    - python: "3.9"
      env:
        - JOB=check
    - python: "3.9"
      env:
        - JOB=docs
  allow_failures:
    - python: "nightly"
    - python: "pypy3"

install: |
  case $JOB in
    tests) pip install .;;
    docs) pip install .[doc];;
    check) pip install mypy;;
  esac

script: |
  case $JOB in
    tests) python setup.py test;;
    docs) python setup.py build; make -C doc html man;;
    check) mypy --ignore-missing-imports khard;;
  esac

deploy:
  provider: pypi
  server: https://test.pypi.org/legacy/
  username: __token__
  password:
    secure: fZuXQbwE0u4nyBIPmSsIVd/fWJ4E4gHFwMbhdaRZcwu5rIj8Q46rPZYcLv4xGWEqEyMHwNkmmJc0Pi0e3WFRVUMOrTPbWy1Og74MxiddpeTBQ5ekDjgO/hQ72vYZaV/lyPyitDtEk8KsncmD70FhLBmMqHKGeDR+m7kQkMsvnsAmyK8vaLXN0S0XkhblBonf59JOiXL3mfahrOOScRyrXZNp40xCfJeAB/7Bi37KwGO3no0M6EoIWlOZzgHVZepPUn17RFj+nvrW4Hir6YwaNPF5qoN3b08RKTV7PTdzIx4mdt5+xMQEkrrIUxKAXdpvApnfLHBvs1r3d2ibSITf/wpDCOGputJt9aknW3OOPJoZfw4NcuvqqWChvfiA+ufZbk0GyzLJTU2ejGfn9PlILndyb8dBjAbRWfeV6yReJlnyvf9BtbFHvFjEMwXpv8cDmy+u4MtfkD56OmUBbFZgkQtF++hUiS+mF2dOgcszsQZ0jy1GSma8IwMF8tqfYWs9xRI7A4F2CDxU7QhwoIQrnSxCR32fIRJKRjw7aJhKaBSdn6E2akQd0vwDjbuKX5Ypdqp15AuKkONDjI7hSRTP/ptDKJZzhkJ1Cda/dJCSFz2prxtVLNTxSgVP3DdYHVLTgUbHuVGoHNzFg0omh3uNCQvfcrHN9OrcxJr7ZkR25P8=
  # see https://blog.travis-ci.com/2019-08-27-deployment-tooling-dpl-v2-preview-release
  edge: true # opt in to dpl v2
  skip_existing: true
  on:
    tags: true
  distributions: sdist bdist_wheel
